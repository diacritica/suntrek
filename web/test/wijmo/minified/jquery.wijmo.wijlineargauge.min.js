/*
 *
 * Wijmo Library 2.2.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijlineargauge",a.wijmo.wijgauge,{options:{orientation:"horizontal",xAxisLocation:.1,xAxisLength:.8,yAxisLocation:.5,width:"auto",height:"auto",pointer:{length:.5,width:4,offset:0,visible:true,template:null},marginLeft:5,marginTop:5,marginRight:5,marginBottom:5},_setDefaultWidth:function(){var a=this.options;a.width=a.orientation==="horizontal"?310:70},_setDefaultHeight:function(){var a=this.options;a.height=a.orientation==="horizontal"?70:310},_set_orientation:function(){var a=this;a._setDefaultWidth();a._setDefaultHeight();a.markBbox=null;a.redraw()},_set_xAxisLocation:function(){this.redraw()},_set_xAxisLength:function(){this.redraw()},_set_yAxisLocation:function(){this.redraw()},_create:function(){a.wijmo.wijgauge.prototype._create.apply(this,arguments);this.element.addClass("wijmo-wijlineargauge")},_paintLabel:function(h,g){var d=this,o=d.options,k=g.format,n=g.style,l=g.offset,i=h,m=d.options.tickMajor,j=m.position||"inside",b,f,c,e;if(k!=="")i=a.wijgauge.formatString(h,k);c=d._getMarkerBbox();e=d._getLabelBBox(i);b=d._valueToPoint(h,0);if(o.orientation==="horizontal"){if(j==="inside")b.y=c.y-e.height;else b.y=c.y+c.width;b.y+=l}else{if(j==="inside")b.x=c.x-e.width/2;else b.x=c.x+c.width+e.width/2;b.x+=l}f=d.canvas.text(b.x,b.y,i);f.attr(n);a.wijraphael.addClass(a(f.node),"wijmo-wijlineargauge-label");return f},_getLabelBBox:function(d){var c=this,e=c.options,a,b;a=c.canvas.text(0,0,d);a.attr(e.gaugeLableStyle);b=a.wijGetBBox();a.remove();return b},_getMarkerBbox:function(){var a=this,d=a.options,c=d.tickMajor,b;if(!a.markBbox){b=a._paintMark(0,c);a.markBbox=b.wijGetBBox();b.remove()}return a.markBbox},_paintMark:function(i,f,n){var b=this,k=b.options,d=f.marker||"rect",l=d==="rect"?5:2,e=b._valueToPoint(i,0),m=f.position||"inside",o=f.offset||0,j=n?2:1,g,c,h=a.extend({},f.style);g=l*f.factor;if(a.isFunction(d))return d.call(b,b.canvas,e,k);else{if(d==="cross")h.stroke=h.fill;if(k.orientation==="horizontal")c=a.wijgauge.paintMarker(b.canvas,d,e.x,e.y,j,g,true);else c=a.wijgauge.paintMarker(b.canvas,d,e.x,e.y,g,j)}c.attr(h);a.wijraphael.addClass(a(c.node),"wijmo-wijlineargauge-mark");b._applyPosition(c,m,o,i);return c},_applyPosition:function(f,g,a){var c=0,d=0,h=this,e=h.options.orientation==="horizontal",b=f.wijGetBBox();switch(g){case"inside":if(e)d-=b.width/2+a;else c-=b.width/2+a;break;case"outside":if(e)d+=b.width/2+a;else c+=b.width/2+a;break;case"center":if(e)d-=a;else c-=a}f.attr("transform","t"+c+","+d)},_paintFace:function(){var b=this,d,c=b.options,f=b._innerBbox.width,e=b._innerBbox.height,g=b._innerBbox.left,h=b._innerBbox.top,i={width:f,height:e,x:g,y:h,canvas:b.canvas};if(c.face&&c.face.template&&a.isFunction(c.face.template))return c.face.template.call(b,i);d=b.canvas.rect(g,h,f,e,5);c.face&&c.face.style&&d.attr(c.face.style);a.wijraphael.addClass(a(d.node),"wijmo-wijlineargauge-face");return d},_paintPointer:function(){var c=this,h=c.options,g=c._valueToPoint(0,0),j=c._innerBbox.width,i=c._innerBbox.height,l=c._innerBbox.left,m=c._innerBbox.top,b=h.pointer,e,d,f,k;if(!b.visible)return;k=h.orientation==="horizontal"?i:j;f=k*b.offset;d=k*b.length;if(b.template&&a.isFunction(b.template))e=b.template.call(c.canvas,g,a.extend({},h.pointer,{offset:f,length:d,gaugeBBox:c._innerBbox}));else{if(h.orientation==="horizontal")if(b.shape==="rect")e=c.canvas.rect(g.x-b.width/2,i-d-f+m,b.width,d);else e=c.canvas.isoTri(g.x,i-d-f+m,b.width,d,"north");else if(b.shape==="rect")e=c.canvas.rect(j-d-f+l,g.y-b.width/2,d,b.width);else e=c.canvas.isoTri(j-d-f+l,g.y-b.width/2,d,b.width);e.attr(b.style)}a.wijraphael.addClass(a(e.node),"wijmo-wijlineargauge-pointer");c.pointer=e},_setPointer:function(){var b=this,c=b.options;if(!b.pointer)return;a.wijmo.wijgauge.prototype._setPointer.apply(this,arguments);b._setLinearPointer(c.value)},_setLinearPointer:function(g){var b=this,f=b.options,d=b._valueToPoint(0,0),e=b._valueToPoint(g,0),c=f.animation,a={x:0,y:0};if(f.orientation==="horizontal")a.x=e.x-d.x;else a.y=e.y-d.y;if(c.enabled)b.pointer.stop().wijAnimate({transform:"t"+a.x+","+a.y},c.duration,c.easing);else b.pointer.attr("transform","t"+a.x+","+a.y)},_minScreenPoint:function(h){var a=this,b=a.options,e=a._innerBbox.width,d=a._innerBbox.height,f=a._innerBbox.left,g=a._innerBbox.top,c=b.yAxisLocation+h;return b.orientation==="horizontal"?{x:e*b.xAxisLocation+f,y:d*c+g}:{x:e*c+f,y:d*(1-b.xAxisLocation)+g}},_maxScreenPoint:function(i){var a=this,b=a.options,e=a._innerBbox.width,d=a._innerBbox.height,f=a._innerBbox.left,h=a._innerBbox.top,c=b.yAxisLocation+i,g=b.xAxisLocation+b.xAxisLength;return b.orientation==="horizontal"?{x:e*g+f,y:d*c+h}:{x:e*c+f,y:d*(1-g)+h}},_paintRange:function(a){var g=this,d=g.options,b=isNaN(a.startValue)?0:a.startValue,c=isNaN(a.endValue)?0:a.endValue,h=isNaN(a.startWidth)?isNaN(a.width)?0:a.width:a.startWidth,i=isNaN(a.endWidth)?isNaN(a.width)?0:a.width:a.endWidth,j=a.startDistance||0,k=a.endDistance||0,e,f;if(b!==c){if(c>b){e=Math.max(b,d.min);f=Math.min(d.max,c)}else{e=Math.max(d.min,c);f=Math.min(d.max,b)}g._drawRange(e,f,j,k,h,i,a)}},_drawRange:function(s,u,e,f,n,o,v){var b=this,w=b.options,t=w.orientation,k=b._innerBbox.width,j=b._innerBbox.height,q=b._innerBbox.left,r=b._innerBbox.top,c=b._valueToPoint(s,0),d=b._valueToPoint(u,0),l,m,p,i,g,h;if(t==="horizontal"){g=n*j;h=o*j;if(e!==0)c.y=e*j+r;if(f!==0)d.y=f*j+r;l={x:c.x,y:c.y-g};m={x:d.x,y:d.y-h}}else{g=n*k;h=o*k;if(e!==0)c.x=e*k+q;if(f!==0)d.x=f*k+q;l={x:c.x-g,y:c.y};m={x:d.x-h,y:d.y}}p=["M",c.x,c.y,"L",d.x,d.y,"L",m.x,m.y,"L",l.x,l.y,"Z"];i=b.canvas.path(p.concat(" "));i.attr(v.style);a.wijraphael.addClass(a(i.node),"wijmo-wijlineargauge-range");b.ranges.push(i)},_valueToPoint:function(g,e){var b=this,f=b.options,a,d,c;if(f.max===f.min)return{x:0,y:0};a=b._valueToLogical(g);d=b._minScreenPoint(e);c=b._maxScreenPoint(e);return{x:d.x*(1-a)+c.x*a,y:d.y*(1-a)+c.y*a}}})})(jQuery);