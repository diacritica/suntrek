/*
 *
 * Wijmo Library 2.2.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(b){"use strict";var z,a,c,y,i,j,k,l,m,n,d,e,h,w,x,o,p,q,r,f,g,s,t,u,v;b.widget("wijmo.wijinputdate",b.extend(true,{},wijinputcore,{options:{date:null,minDate:null,maxDate:null,dateFormat:"d",startYear:1950,smartInputMode:true,activeField:0,keyDelay:800,autoNextField:true,calendar:"default",popupPosition:{offset:"0 4"},dateChanged:null},_createTextProvider:function(){this._textProvider=new z(this,this.options.dateFormat)},_strToDate:function(a){return this._textProvider.parseDate(a)},_beginUpdate:function(){var a=this.options,c,b=null;if(a.minDate)if(typeof a.minDate==="string")a.minDate=this._strToDate(a.minDate);if(a.maxDate)if(typeof a.maxDate==="string")a.maxDate=this._strToDate(a.maxDate);if(!a.date){if(!!this.element.data("elementValue"))c=this.element.data("elementValue")}else if(typeof a.date==="string")c=a.date;else b=a.date;if(c)b=this._strToDate(c);this._safeSetDate(b);this.element.data({defaultDate:b===null?b:new Date(a.date.getTime()),preDate:b===null?b:new Date(a.date.getTime())});this._resetTimeStamp();a.showTrigger&&!this._hasComboItems()&&this._initCalendar();this.element.addClass("wijmo-wijinput-date").attr({"aria-valuemin":new Date(1900,1,1),"aria-valuemax":new Date(2099,1,1),"aria-valuenow":a.date})},_endUpdate:function(){var a=this;this.element.click(function(){a._highLightCursor()});this.element.mousewheel(function(c,b){a._doSpin(b>0,false)})},_onTriggerClicked:function(){if(this._hasComboItems())this._popupComboList();else this._popupOrHideCalendar()},_isValidDate:function(a,c){var b=this.options;if(a===undefined)return false;if(isNaN(a))return false;if(a.getFullYear()<1||a.getFullYear()>9999)return false;if(c){if(b.minDate)if(a<b.minDate)return false;if(b.maxDate)if(a>b.maxDate)return false}return true},_checkRange:function(a){var b=this.options;if(!!a){if(b.minDate&&a<b.minDate)a=new Date(Math.max(b.minDate,a));if(b.maxDate&&a>b.maxDate)a=new Date(Math.min(b.maxDate,a))}return a},_safeSetDate:function(a){var c=this.options,b=a;a=this._checkRange(a);if(isNaN(a))a=b;c.date=a;return true},_safeGetDate:function(){var b=this.options,a=b.date;if(!a)a=new Date;a=this._checkRange(a);return a},_setOption:function(d,a){b.Widget.prototype._setOption.apply(this,arguments);wijinputcore._setOption.apply(this,arguments);switch(d){case"date":if(!!a){if(typeof a==="string")a=this._strToDate(a);else if(typeof a==="object")a=new Date(a.getTime());else a=new Date(a);if(isNaN(a))a=new Date}this._safeSetDate(a);this._updateText();this._highLightField();break;case"dateFormat":case"culture":this._textProvider._setFormat(this.options.dateFormat);this._updateText();var c=this.element.data("calendar",c);c&&c.wijcalendar("option",d,a);break;case"activeField":a=Math.min(a,this._textProvider.getFieldCount()-1);a=Math.max(a,0);this.options.activeField=a;this._highLightField();this._resetTimeStamp();break;case"nextTooltip":case"prevTooltip":case"titleFormat":case"toolTipFormat":var c=this.element.data("calendar",c);c&&c.wijcalendar("option",d,a)}},_setData:function(a){this.option("date",a)},_resetData:function(){var a=this.element.data("defaultDate");if(a===undefined||a===null){a=this.element.data("elementValue");if(a!==undefined&&a!==null&&a!=="")this.setText(a);else this._setData(null)}else this._setData(a)},_resetTimeStamp:function(){this.element.data("cursorPos",0);this.element.data("timeStamp",new Date("1900/1/1"))},getPostValue:function(){if(!this._isInitialized())return this.element.val();if(this.options.showNullText&&this.isDateNull())return"";var a=this._textProvider.toString();return a===this.options.nullText?"":a},_highLightField:function(a){if(a===undefined)a=this.options.activeField;if(this.isFocused()){var b=this._textProvider.getFieldRange(a);b&&this.element.wijtextselection(b)}},_highLightCursor:function(a){if(this._isNullText())return;if(a===undefined)a=Math.max(0,this.element.wijtextselection().start);var b=this._textProvider.getCursorField(a);if(b<0)return;this._setOption("activeField",b)},_toNextField:function(){this._setOption("activeField",this.options.activeField+1)},_toPrevField:function(){this._setOption("activeField",this.options.activeField-1)},_toFirstField:function(){this._setOption("activeField",0)},_toLastField:function(){this._setOption("activeField",this._textProvider.getFieldCount())},_clearField:function(a){if(a===undefined)a=this.options.activeField;var b=this._textProvider.getFieldRange(a),c,d=this;if(b){c=new wijInputResult;this._textProvider.removeAt(b.start,b.end,c);this._updateText();window.setTimeout(function(){d._highLightField()},1)}},_doSpin:function(c,a){c=!!c;a=!!a;if(!this._allowEdit())return;if(a&&this.element.data("breakSpinner"))return;if(this._textProvider[c?"incEnumPart":"decEnumPart"]()){this._updateText();this._highLightField()}a&&!this.element.data("breakSpinner")&&window.setTimeout(b.proxy(function(){this._doSpin(c,true)},this),this._calcSpinInterval())},_onChange:function(){},_afterFocused:function(){this._isNullText()&&this._doFocus();var a=this,b=function(){a._highLightCursor();a._resetTimeStamp()};window.setTimeout(b,10)},_keyDownPreview:function(a){var d=a.keyCode||a.which,c;switch(d){case b.ui.keyCode.LEFT:this._toPrevField();return true;case b.ui.keyCode.RIGHT:this._toNextField();return true;case b.ui.keyCode.TAB:case b.ui.keyCode.SPACE:case 188:case 190:case 110:case 191:if(a.shiftKey){if(this.options.activeField>0){this._toPrevField();return true}}else if(this.options.activeField<this._textProvider.getFieldCount()-1){this._toNextField();return true}break;case b.ui.keyCode.HOME:if(a.ctrlKey)this._setOption("date",new Date);else this._toFirstField();return true;case b.ui.keyCode.END:if(a.ctrlKey)this._setOption("date",new Date("1970/1/1"));else this._toLastField();return true;case b.ui.keyCode.DELETE:if(this._allowEdit()){c=this.element.wijtextselection();if(c.end-c.start===this.element.val().length){this.isDeleteAll=true;this._setOption("date",new Date("1970/1/1"))}else this._clearField();return true}}return false},_autoMoveToNextField:function(a,b){if(!this.options.autoNextField)return;this._textProvider.needToMove(this.options.activeField,a,b)&&this._toNextField()},_keyPressPreview:function(c){var d=c.keyCode||c.which,g,e,i,a,h,f,j,k,l;if(d===b.ui.keyCode.ENTER){if(this.isDateNull())this.options.date=new Date;return false}g=this._textProvider.getFieldRange(this.options.activeField);if(g){if(d===b.ui.keyCode.TAB)return true;if(d===b.ui.keyCode.SPACE){this._stopEvent(c);return true}e=String.fromCharCode(d);i=this._textProvider.isFieldSep(e,this.options.activeField);if(i){this._toNextField();this._stopEvent(c);return true}a=this.element.data("cursorPos");h=new Date;j=this.element.data("timeStamp");this.element.data("timeStamp",h);f=h.getTime()-j.getTime()>this.options.keyDelay;if(f)a=0;k=g.start+a;this.element.data("cursorPos",++a);l=this._textProvider.addToField(e,this.options.activeField,k,!f);if(l){this._updateText();this._autoMoveToNextField(a,e);this._highLightField()}else{this._resetTimeStamp();this._fireIvalidInputEvent()}this._stopEvent(c);return true}return false},_raiseDataChanged:function(){var a=this.options.date,b=this.element.data("preDate");this.element.data("preDate",!a?null:new Date(a.getTime()));if(!b&&a||b&&!a||b&&a&&b.getTime()!==a.getTime()){this._syncCalendar();this.element.attr("aria-valuenow",a);this._trigger("dateChanged",null,{date:a})}},isDateNull:function(){return this.options.date===null||this.options.date===undefined},_isMinDate:function(a){return a.getFullYear()===1&&a.getMonth()===0&&a.getDate()===1},_initCalendar:function(){var d=this,c=d.options,a=c.calendar,e;if(a===undefined||a===null)return;if(typeof a==="boolean"||a==="default"){a=b("<div/>");a.appendTo(document.body)}e=b(a);if(e.length!==1)return;d.element.data("calendar",e);e.wijcalendar({popupMode:true,culture:c.culture,nextTooltip:c.nextTooltip||"Next",prevTooltip:c.prevTooltip||"Previous",titleFormat:c.titleFormat||"MMMM yyyy",toolTipFormat:c.toolTipFormat||"dddd, MMMM dd, yyyy",selectedDatesChanged:function(){var a=b(this).wijcalendar("getSelectedDate");b(this).wijcalendar("close");!!a&&d.option("date",a);d._trySetFocus()}});d._syncCalendar()},_syncCalendar:function(){var a=this.element.data("calendar"),c,b;if(!a)return;c=this.options;b=this._safeGetDate();if(this._isMinDate(b))b=new Date;a.wijcalendar("option","displayDate",b);c.minDate&&a.wijcalendar("option","minDate",c.minDate);c.maxDate&&a.wijcalendar("option","maxDate",c.maxDate);a.wijcalendar("unSelectAll");a.wijcalendar("selectDate",b);a.wijcalendar("refresh")},_popupOrHideCalendar:function(){if(!this._allowEdit())return;var a=this.element.data("calendar");if(!a)return;if(a.wijcalendar("isPopupShowing")){a.wijcalendar("hide");this._trySetFocus();return}this._syncCalendar();a.wijcalendar("popup",b.extend({},this.options.popupPosition,{of:this.outerDiv}))},_isCalendarVisible:function(){if(!this._allowEdit())return false;var a=this.element.data("calendar");return!a?false:a.wijcalendar("isPopupShowing")},_popupVisible:function(){return this._hasComboItems()?this._isComboListVisible():this._isCalendarVisible()}}));z=function(b,a){this.inputWidget=b;this.descriptors=new Array(0);this.desPostions=new Array(0);this.fields=new Array(0);this._setFormat(a)};z.prototype={descriptors:undefined,desPostions:undefined,maskPartsCount:0,pattern:"M/d/yyyy",initialize:function(){},getFieldCount:function(){return this.fields.length},getFieldRange:function(b){var a=this.fields[b];return{start:a.startIndex,end:a.startIndex+a.getText().length}},getCursorField:function(a){a=Math.min(a,this.desPostions.length-1);a=Math.max(a,0);var c=this.desPostions[a].desc,d;if(c.type===-1){d=b.inArray(c,this.descriptors);if(d>0&&this.descriptors[d-1].type!==-1)c=this.descriptors[d-1];else return-1}return b.inArray(c,this.fields)},needToMove:function(c,d,e){if(!this.inputWidget._isValidDate(this.inputWidget._safeGetDate(),true))return false;var b=this.fields[c],a;if(d===b.maxLen)return true;a=e*1;if(isNaN(a))return false;switch(b.type){case 20:case 25:case 45:case 46:return a>1;case 47:case 48:return a>2;case 30:case 31:return a>3;case 50:case 51:case 60:case 61:return a>6}return false},_getCulture:function(){return this.inputWidget._getCulture()},_isDigitString:function(a){a=b.trim(a);if(a.length===0)return true;var c=a.charAt(0),d,e;if(c==="+"||c==="-"){a=a.substr(1);a=b.trim(a)}if(a.length===0)return true;try{d=parseFloat(a);e=d.toString();return e===a}catch(f){return false}},_setFormat:function(h){this.descriptors=[];var a="",d="",f=false,g=false,e,c;this.pattern=this._parseFormatToPattern(h);for(e=0;e<this.pattern.length;e++){c=this.pattern.charAt(e);if(g){this.descriptors.push(this.createDescriptor(-1,c));a="";g=false;continue}if(c==="\\"){g=true;if(a.length>0){!this.handlePattern(a)&&this.descriptors.push(this.createDescriptor(-1,d));a=""}continue}if(c==="'"){if(f){f=false;a=""}else{f=true;if(a.length>0){!this.handlePattern(a)&&this.descriptors.push(this.createDescriptor(-1,d));a=""}}continue}if(f){this.descriptors.push(this.createDescriptor(-1,c));a="";continue}if(!e)d=c;if(d!==c&&a.length>0){!this.handlePattern(a)&&this.descriptors.push(this.createDescriptor(-1,d));a=""}a+=c;d=c}if(a.length>0)!this.handlePattern(a)&&this.descriptors.push(this.createDescriptor(-1,d));this.fields=b.grep(this.descriptors,function(a){return a.type!==-1})},_parseFormatToPattern:function(c){var a=this.inputWidget._getCulture().calendars.standard,b=a.patterns.d;if(c.length<=1)switch(c){case"":case"d":b=a.patterns.d;break;case"D":b=a.patterns.D;break;case"f":b=a.patterns.D+" "+a.patterns.t;break;case"F":b=a.patterns.D+" "+a.patterns.T;break;case"g":b=a.patterns.d+" "+a.patterns.t;break;case"G":b=a.patterns.d+" "+a.patterns.T;break;case"m":b=a.patterns.M;break;case"M":b=a.patterns.M;break;case"s":b=a.patterns.S;break;case"t":b=a.patterns.t;break;case"T":b=a.patterns.T;break;case"u":b=a.patterns.S;break;case"U":b=a.patterns.D+" "+a.patterns.T;break;case"y":b=a.patterns.Y;break;case"Y":b=a.patterns.Y}else b=c;return b},getDate:function(){return!!this.inputWidget?new Date(this.inputWidget._safeGetDate().getTime()):undefined},setDate:function(a){this.inputWidget&&this.inputWidget._setData(a)},_internalSetDate:function(e){if(this.inputWidget){var c=this,a=this.inputWidget.options,d=this.inputWidget.element,f=!!d.data("typing"),b;if(f){a.date=e;b=function(){var f=new Date,e=d.data("timeStamp");if(f.getTime()-e.getTime()>a.keyDelay){c.inputWidget._safeSetDate(a.date);c.inputWidget._updateText();c.inputWidget._highLightField()}else window.setTimeout(b,a.keyDelay)};window.setTimeout(b,a.keyDelay)}else this.inputWidget._safeSetDate(e)}},daysInMonth:function(a,c){a=a-1;var b=new Date(c,++a,1,-1).getDate();return b},setYear:function(a,d,i){try{if(d&&d.isfullreset){d.offset=1;a="1970"}if(typeof a==="string")if(!this._isDigitString(a))return false;a=a*1;var h=this.inputWidget.options,e=1,f=9999,c,b,g;if(i){if(h.minDate)e=Math.max(e,h.minDate.getFullYear());if(h.maxDate)f=Math.min(f,h.maxDate.getFullYear())}if(d&&d.isreset)a=e;if(a<e)a=e;if(a>f)a=f;c=this.getDate();b=new Date(c.getTime());b.setFullYear(a);if(this._isValidDate(b)){g=this.daysInMonth(this.getMonth(),this.getYear());if(g===c.getDate()){b=new Date(c.getTime());b.setDate(1);b.setFullYear(a);g=this.daysInMonth(b.getMonth()+1,b.getFullYear());b.setDate(g);if(this._isValidDate(b)){this._internalSetDate(b);return true}else return false}c.setFullYear(a);this._internalSetDate(c);return true}else{if(d&&d.isreset){c.setFullYear(1);this._internalSetDate(c);return true}return false}}catch(j){return false}},getYear:function(){try{var a=this.getDate().getFullYear();a=""+a+"";while(a.length<4)a="0"+a;return""+a+""}catch(b){alert("getYear() failed")}return""},setMonth:function(b,e,c){try{if(c&&c.isfullreset)b="1";b=b*1;var f=this.getDate(),d,a;if(typeof e!=="undefined"&&!e)if(b>12||b<1)if(c&&c.isreset)b=1;else return false;d=this.daysInMonth(this.getMonth(),this.getYear());if(d===this.getDate().getDate()){a=new Date(f.getTime());a.setDate(1);a.setMonth(b-1);d=this.daysInMonth(a.getMonth()+1,a.getFullYear());a.setDate(d);if(this._isValidDate(a)){this._internalSetDate(a);return true}else return false}else{a=new Date(f.getTime());a.setMonth(b-1);if(this._isValidDate(a)){this._internalSetDate(a);return true}else return false}}catch(g){return false}},getMonth:function(){return this.getDate().getMonth()+1},setDayOfMonth:function(b,c,a){try{if(a&&a.isfullreset)return this.setDayOfMonth(1,c);var f=this.getDate(),e,d;b=b*1;if(typeof c!=="undefined"&&!c){e=this.daysInMonth(this.getMonth(),this.getYear());if(b>e||b<1)return a&&a.isreset?this.setDayOfMonth(1,c,a):false}d=new Date(f.getTime());d.setDate(b);if(this._isValidDate(d)){this._internalSetDate(d);return true}else return false}catch(g){return false}},getDayOfMonth:function(){return this.getDate().getDate()},setHours:function(a,c){try{a=a*1;if(typeof c!=="undefined"&&!c)if(a>24)return false;var b=new Date(this.getDate().getTime());b.setHours(a);if(this._isValidDate(b)){this._internalSetDate(b);return true}else return false}catch(d){return false}},getHours:function(){return this.getDate().getHours()},setMinutes:function(a,c){try{a=a*1;if(typeof c!=="undefined"&&!c)if(a>60)return false;var b=new Date(this.getDate().getTime());b.setMinutes(a);if(this._isValidDate(b)){this._internalSetDate(b);return true}else return false}catch(d){return false}},getMinutes:function(){return this.getDate().getMinutes()},setSeconds:function(a,c){try{a=a*1;if(typeof c!=="undefined"&&!c)if(a>60)return false;var b=new Date(this.getDate().getTime());b.setSeconds(a);if(this._isValidDate(b)){this._internalSetDate(b);return true}else return false}catch(d){return false}},getSeconds:function(){return this.getDate().getSeconds()},setDayOfWeek:function(a){try{a=a*1;var b=a-this.getDayOfWeek()*1;return this.setDayOfMonth(this.getDayOfMonth()*1+b*1,true)}catch(c){return false}},getDayOfWeek:function(){return this.getDate().getDay()+1},handlePattern:function(c){var a=new RegExp("y{3,4}"),b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(10));return true}a=new RegExp("y{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(2));return true}a=new RegExp("y{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(1));return true}a=new RegExp("d{4,4}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(101));return true}a=new RegExp("d{3,3}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(100));return true}a=new RegExp("d{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(30));return true}a=new RegExp("d{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(31));return true}a=new RegExp("M{4,4}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(27));return true}a=new RegExp("M{3,3}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(26));return true}a=new RegExp("M{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(20));return true}a=new RegExp("M{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(25));return true}a=new RegExp("h{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(46));return true}a=new RegExp("h{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(45));return true}a=new RegExp("H{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(48));return true}a=new RegExp("H{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(47));return true}a=new RegExp("m{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(50));return true}a=new RegExp("m{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(51));return true}a=new RegExp("s{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(60));return true}a=new RegExp("s{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(61));return true}a=new RegExp("t{2,2}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(251));return true}a=new RegExp("t{1,1}");b=a.test(c);if(b){this.descriptors.push(this.createDescriptor(250));return true}return false},createDescriptor:function(z,c){var a=null,b=this.maskPartsCount++;switch(z){case-1:a=new y(this,b);a.liternal=c;break;case 20:a=new i(this,b);break;case 25:a=new j(this,b);break;case 26:a=new k(this,b);break;case 27:a=new l(this,b);break;case 30:a=new m(this,b);break;case 31:a=new n(this,b);break;case 100:a=new d(this,b);break;case 101:a=new e(this,b);break;case 10:a=new h(this,b);break;case 1:a=new w(this,b);break;case 2:a=new x(this,b);break;case 45:a=new o(this,b);break;case 46:a=new p(this,b);break;case 47:a=new q(this,b);break;case 48:a=new r(this,b);break;case 250:a=new f(this,b);break;case 251:a=new g(this,b);break;case 50:a=new s(this,b);break;case 51:a=new t(this,b);break;case 60:a=new u(this,b);break;case 61:a=new v(this,b)}return a},toString:function(){if(this.inputWidget.options.showNullText&&!this.inputWidget.isFocused()&&this.inputWidget.isDateNull())return this.inputWidget.options.nullText;var e="",f=0,b,c,d,a;this.desPostions=new Array(0);for(b=0;b<this.descriptors.length;b++){this.descriptors[b].startIndex=e.length;c=""||this.descriptors[b].getText();e+=c;for(d=0;d<c.length;d++){a={};a.desc=this.descriptors[b];a.pos=d;a.text=c;a.length=c.length;this.desPostions.push(a);f++;if(this.desPostions.length!==f)throw"Fatal Error !!!!!!!!!!!!!!!";}}return e},parseDate:function(b){var a;if(this.pattern==="dddd"||this.pattern==="ddd"||typeof b==="object")try{a=new Date(b);if(isNaN(a))a=new Date}catch(c){a=new Date}else{a=Globalize.parseDate(b,this.pattern,this._getCulture());if(!a)a=this._tryParseDate(b,this.pattern);if(!a)a=new Date}return a},"set":function(a){this._internalSetDate(new Date(this.parseDate(a)));return true},haveEnumParts:function(){return false},removeLiterals:function(a){a=""+a+"";a=a.replace(new RegExp("\\s","g"),"");a=a.replace(new RegExp("[+]","g"),"");a=a.replace(new RegExp("[.]","g"),"");a=a.replace(new RegExp("[:]","g"),"");a=a.replace(new RegExp("[-]","g"),"");a=a.replace(new RegExp("[()=]","g"),"");return a},getFirstDelimiterPos:function(b,d){var c=0,a=0,e,f;while(c<d.length&&a<b.length){e=d.charAt(c);f=b.charAt(a);if(e===f)a++;else return a-1;c++}return b.length-1},findAlikeArrayItemIndex:function(d,f){for(var c=-1,e=99999,b,a=0;a<d.length;a++){b=d[a].toLowerCase().indexOf(f.toLowerCase());if(b!==-1&&b<e){e=b;c=a}}return c},_isValidDate:function(a){return this.inputWidget._isValidDate(a)},isFieldSep:function(d,c){var b=c++,a;if(b<this.descriptors.length){a=this.descriptors[b];return a.type!==-1?false:d===a.text}return false},getPositionType:function(b){var a=this.desPostions[b];return a.desc.type},addToField:function(a,f,h,g){var b=this.fields[f],e,c,d;if(b.type===10)return this.insertAt(a,h);e=g?b.getText()+a:a;c={val:a,pos:0,offset:0,isreset:false};this.inputWidget.element.data("typing",true);d=b.setText(e,a.length===1?false:true,c);this.inputWidget.element.data("typing",false);return d},insertAt:function(c,j,b){if(!b)b=new wijInputResult;b.testPosition=-1;var a,q,d,f,m,i,p,e,h,o,n,k,l,s,t,g,r;if(c.length===1){a=this.desPostions[j];if(a&&a.desc.type===-1)if(a.text===c){b.testPosition=j;b.hint=b.characterEscaped;return true}}q=c;d=j;c=this.removeLiterals(c);f=c;m=false;p=false;if(d>0&&f.length===1){d--;j=d;a=this.desPostions[d];m=true;if(a&&(a.desc.type===-1||a.desc.getText().length!==1)){j++;d++;m=false}}i=false;while(f.length>0&&d<this.desPostions.length){a=this.desPostions[d];if(a.desc.type===-1){d=d+a.length;continue}if(a.desc.needAdjustInsertPos()){e=f.substr(0,a.length-a.pos);e=a.text.slice(0,a.pos)+e+a.text.slice(a.pos+e.length,a.length);if(m)e=a.text+e;if(p)e=e+a.text;o=a.desc.getText().length;k="";try{if(c.length===1)if(!a.pos)k=c;else if(a.pos>0)k=e.substring(0,a.pos+1)}catch(u){}if(o===1&&e.length>1&&c.length===1)if(a.desc.type===31||a.desc.type===25)this._disableSmartInputMode=true;h={val:c,pos:a.pos,offset:0,isreset:false};i=a.desc.setText(e,c.length===1?false:true,h);this._disableSmartInputMode=false;if(!i&&typeof k!=="undefined"&&k.length>0&&(a.desc.type===26||a.desc.type===27||a.desc.type===100||a.desc.type===101||a.desc.type===250||a.desc.type===251))i=a.desc.setText(k,c.length===1?false:true,h);if(i){b.hint=b.success;b.testPosition=d+h.offset;if(c.length===1){l=a.desc.getText().length;n=a.pos;if(a.pos>l-1)n=l;s=l-o;if(s>0&&a.pos===o-1)n=l-1;t=this.toString();b.testPosition=a.desc.startIndex+n+h.offset}f=f.slice(a.length-a.pos,f.length)}else{b.hint=b.invalidInput;if(b.testPosition!==-1)b.testPosition=j;if(a.desc.type!==-1&&c.length===1)return false}d=d+a.length}else{g=this.getFirstDelimiterPos(f,q);if(g<0)g=0;e=f.substring(0,g+1);h={val:c,pos:a.pos,offset:0,isreset:false};i=a.desc.setText(e,c.length===1?false:true,h);if(i){b.hint=b.success;b.testPosition=d+h.offset;f=f.slice(g+1,f.length)}else{b.hint=b.invalidInput;if(b.testPosition!==-1)b.testPosition=j}if(g<0)g=0;r=g+1;d=d+r}}return i},removeAt:function(b,e,c){try{var a=this.desPostions[b],d,g,f,h,i=this.inputWidget,k=i.element,j=k.val().length;if(j===e+1&&b===0)i.isDeleteAll=true;if(a.desc.needAdjustInsertPos()){d="0";g=b;a.text=a.desc.getText();d=a.text.slice(0,a.pos)+d+a.text.slice(a.pos+d.length,a.length);f={val:d,pos:a.pos,offset:0,isreset:true,isfullreset:false};if(e-b+1>=a.length){f.isfullreset=true;b=b+a.length;g=b}h=a.desc.setText(d,false,f);if(h){c.hint=c.success;c.testPosition=g}else{c.hint=c.invalidInput;if(c.testPosition===-1)c.testPosition=b}}b<e&&this.removeAt(b+1,e,c);return true}catch(l){return false}},incEnumPart:function(){var a=this.fields[this.inputWidget.options.activeField];a&&a.inc();return true},decEnumPart:function(){var a=this.fields[this.inputWidget.options.activeField];a&&a.dec();return true},setValue:function(a){this.setDate(new Date(a instanceof Date?a.getTime():a));return true},getValue:function(){return this.getDate()},_disableSmartInputMode:false,_isSmartInputMode:function(){return this._disableSmartInputMode?false:this.inputWidget?this.inputWidget.options.smartInputMode:true},_getInt:function(g,e,d,f){for(var a,c=f;c>=d;c--){a=g.substring(e,e+c);if(a.length<d)return null;if(b.wij.charValidator.isDigit(a))return a}return null},_tryParseDate:function(e,a){var g=this._getCulture().calendars,d,c,f,b;a=a||g.standard.patterns.d;if(a){if(a.indexOf("MMM")===-1&&a.indexOf("MMMM")===-1)a=a.replace("MM","M");a=a.replace("dd","d");a=a.replace("tt","a")}d=a.replace("yyyy","yy");c=g.standard["/"];f=[a,d,a.replace(new RegExp(c,"g"),"-"),d.replace(new RegExp(c,"g"),"-"),a.replace(new RegExp(c,"g"),"."),d.replace(new RegExp(c,"g"),".")];b=Globalize.parseDate(e,f,this._getCulture());if(b)return b;b=new Date(e);return b.toString()!=="Invalid Date"&&e&&e!==""?b:0},paddingZero:function(c,b){var a=""+c+"";while(a.length<b)a="0"+a;return a},_formatDate:function(a,f,d){if(!a.valueOf())return"&nbsp;";var b=this,c=this.inputWidget._getCulture().calendars.standard,e=f.replace(new RegExp("yyyy|MMMM|MMM|MM|M|mm|m|dddd|ddd|dd|d|hh|h|HH|H|ss|s|tt|t|a/p","gi"),function(f){var e;switch(f){case"yyyy":return a.getFullYear();case"MMMM":return d.dateTimeFormat.monthNames[a.getMonth()];case"MMM":return d.dateTimeFormat.abbreviatedMonthNames[a.getMonth()];case"MM":return b.paddingZero(a.getMonth()+1,2);case"M":return b.paddingZero(a.getMonth()+1,1);case"mm":return b.paddingZero(a.getMinutes(),2);case"m":return b.paddingZero(a.getMinutes(),1);case"dddd":return d.dateTimeFormat.dayNames[a.getDay()];case"ddd":return d.dateTimeFormat.abbreviatedDayNames[a.getDay()];case"dd":return b.paddingZero(a.getDate(),2);case"d":return b.paddingZero(a.getDate(),1);case"hh":e=a.getHours()%12;return b.paddingZero(e?e:12,2);case"h":e=a.getHours()%12;return b.paddingZero(e?e:12,1);case"HH":return b.paddingZero(a.getHours(),2);case"H":return b.paddingZero(a.getHours(),1);case"ss":return b.paddingZero(a.getSeconds(),2);case"s":return b.paddingZero(a.getSeconds(),1);case"tt":return a.getHours()<12?c.AM[0]:c.PM[0];case"t":return a.getHours()<12?c.AM[0].length>0?c.AM[0].charAt(0):"":c.PM[0].length>0?c.PM[0].charAt(0):"";case"a/p":return a.getHours()<12?"a":"p"}return"N"});return e}};a=function(d,c,a,b){this._txtProvider=d;this.id=c;this.type=a;this.startIndex=0;this.maxLen=b||2};a.prototype={_txtProvider:null,id:0,type:0,name:null,startIndex:0,maxLen:2,getText:function(){return null},setText:function(){return false},inc:function(){},dec:function(){},needAdjustInsertPos:function(){return true},reachMaxLen:function(){var a=this.getText();do if(a.charAt(0)==="0")a=a.slice(1);else break;while(a.length>0);return a.length>=this.maxLen}};c=function(c,b){for(var a in b.prototype)if(!c.prototype[a])c.prototype[a]=b.prototype[a]};y=function(b,d){c(y,a);a.apply(this,[b,d,-1,100])};y.prototype={liternal:"",getText:function(){return this.liternal}};i=function(b,d){c(i,a);a.apply(this,[b,d,20]);this.name="Two-digit month"};i.prototype={getText:function(){var a=""+this._txtProvider.getMonth()+"";return a.length===1?"0"+a:a},setText:function(c,a,b){return this._txtProvider.setMonth(c,a,b)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};j=function(b,d){c(j,a);a.apply(this,[b,d,25]);this.name="month"};j.prototype={getText:function(){return""+this._txtProvider.getMonth()+""},setText:function(c,a,b){return this._txtProvider.setMonth(c,a,b)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};k=function(b,d){c(k,a);a.apply(this,[b,d,26,100]);this.name="AbbreviatedMonthNames"};k.prototype={getText:function(){var b=this._txtProvider.getMonth(),a=this._txtProvider._getCulture();return a.calendars.standard.months.namesAbbr[b-1]},setText:function(d,b,c){var a=-1,e=this.inputWidget._getCulture().calendars.standard;a=this._txtProvider.findAlikeArrayItemIndex(e.months.namesAbbr,d);return a===-1?false:this._txtProvider.setMonth(a+1,b,c)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};l=function(b,d){c(l,a);a.apply(this,[b,d,27,100]);this.name="MonthNames"};l.prototype={getText:function(){var b=this._txtProvider.getMonth(),a=this._txtProvider._getCulture();return a.calendars.standard.months.names[b-1]},setText:function(e,d,b){var a=-1,c;if(b&&b.isfullreset)a=1;else{c=this._txtProvider._getCulture();a=this._txtProvider.findAlikeArrayItemIndex(c.calendars.standard.months.names,e);if(a===-1)return false}return this._txtProvider.setMonth(a+1,d,b)},inc:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1+1,true)},dec:function(){this._txtProvider.setMonth(this._txtProvider.getMonth()*1-1,true)}};m=function(b,d){c(m,a);a.apply(this,[b,d,30]);this.name="Two-digit day of month"};m.prototype={getText:function(){var a=this._txtProvider.getDayOfMonth();if(a<10)a="0"+a;return""+a+""},setText:function(c,a,b){return this._txtProvider.setDayOfMonth(c,a,b)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)}};n=function(b,d){c(n,a);a.apply(this,[b,d,31]);this.name="Day of month"};n.prototype={getText:function(){var a=this._txtProvider.getDayOfMonth();return""+a+""},setText:function(c,a,b){return this._txtProvider.setDayOfMonth(c,a,b)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)}};d=function(b,e){c(d,a);a.apply(this,[b,e,100,100]);this.name="AbbreviatedDayNames"};d.prototype={getText:function(){var b=this._txtProvider.getDayOfWeek(),a=this._txtProvider._getCulture();return a.calendars.standard.days.namesShort[b-1]},setText:function(c){var a=-1,b=this._txtProvider._getCulture();a=this._txtProvider.findAlikeArrayItemIndex(b.calendars.standard.days.namesShort,c);return a===-1?false:this._txtProvider.setDayOfWeek(a+1)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)},needAdjustInsertPos:function(){return false}};e=function(b,d){c(e,a);a.apply(this,[b,d,101,100]);this.name="DayNames"};e.prototype={getText:function(){var b=this._txtProvider.getDayOfWeek(),a=this._txtProvider._getCulture();return a.calendars.standard.days.names[b-1]},setText:function(c){var a=-1,b=this._txtProvider._getCulture();a=this._txtProvider.findAlikeArrayItemIndex(b.calendars.standard.days.names,c);return a===-1?false:this._txtProvider.setDayOfWeek(a+1)},inc:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1+1,true)},dec:function(){this._txtProvider.setDayOfMonth(this._txtProvider.getDayOfMonth()*1-1,true)},needAdjustInsertPos:function(){return false}};h=function(b,d){c(h,a);a.apply(this,[b,d,10,4]);this.name="Four-digit year"};h.prototype={getText:function(){return this._txtProvider.getYear()},setText:function(j,k,a){if(this._txtProvider._isSmartInputMode()&&a){var b=2e3,e,i,c,f,d,g,h;if(this._txtProvider.inputWidget.options.startYear)b=this._txtProvider.inputWidget.options.startYear;e=b+100-1;b=this._txtProvider.paddingZero(b,4);e=this._txtProvider.paddingZero(e,4);if(a.pos===0||a.pos===1){i=new Date;c=this._txtProvider.paddingZero(this._txtProvider.getYear(),4);if(c.charAt(0)==="0"&&c.charAt(1)==="0"&&a.pos<=1){f=a.val*1;d="00";if(f>=5)d=b.slice(0,2);else d=e.slice(0,2);g=a.val+c.slice(3,4);h=d+g;a.offset=2-a.pos;this._txtProvider.setYear(h,a);return true}}}return this._txtProvider.setYear(j,a)},inc:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1+1,null,true)},dec:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1-1,null,true)}};w=function(b,d){c(w,a);a.apply(this,[b,d,1]);this.name="One-digit year"};w.prototype={getText:function(){var a=this._txtProvider.getYear();a=""+a+"";if(a.length===4)a=a.charAt(2)+a.charAt(3);if(a.charAt(0)==="0")a=a.charAt(1);return a},setText:function(a,i,h){a=a+"";while(a.length<2)a="0"+a;var b=this._txtProvider.getYear(),f,c,e,d,g;b=""+b+"";if(a==="00"){f=this._txtProvider.getMonth();c=this._txtProvider.getDayOfMonth();e=this._txtProvider.getHours();d=this._txtProvider.getMinutes();g=this._txtProvider.getSeconds();if(f===1&&c===1&&!e&&!d&&!g){b="0001";a="01"}}if(b.length>=2)b=b.charAt(0)+b.charAt(1)+a.charAt(0)+a.charAt(1);return this._txtProvider.setYear(b,h)},inc:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1+1,null,true)},dec:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1-1,null,true)}};x=function(b,d){c(x,a);a.apply(this,[b,d,2]);this.name="Two-digit year"};x.prototype={getText:function(){var a=this._txtProvider.getYear();a=""+a+"";if(a.length===4)a=a.charAt(2)+a.charAt(3);return a},setText:function(a,j,i){a=a+"";while(a.length<2)a="0"+a;var b=this._txtProvider.getYear(),g,d,f,e,h,c;b=""+b+"";if(a==="00"){g=this._txtProvider.getMonth();d=this._txtProvider.getDayOfMonth();f=this._txtProvider.getHours();e=this._txtProvider.getMinutes();h=this._txtProvider.getSeconds();if(g===1&&d===1&&!f&&!e&&!h){b="0001";a="01"}}if(b.length>=2)b=b.charAt(0)+b.charAt(1)+a.charAt(0)+a.charAt(1);c=this._txtProvider.setYear(b,i);return c},inc:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1+1,null,true)},dec:function(){this._txtProvider.setYear(this._txtProvider.getYear()*1-1,null,true)}};o=function(b,d){c(o,a);a.apply(this,[b,d,45]);this.name="h"};o.prototype={getText:function(){var a=this._txtProvider.getHours();if(a>12)a=a-12;else if(a===0)a=12;return""+a+""},setText:function(a,b){var c=this._txtProvider.getHours();if(c>12)a=a*1+12;return this._txtProvider.setHours(a,b)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};p=function(b,d){c(p,a);a.apply(this,[b,d,46]);this.name="hh"};p.prototype={getText:function(){var a=this._txtProvider.getHours();if(a>12)a=a-12;else if(a===0)a="12";if(a<10)a="0"+a;return""+a+""},setText:function(a,b){var c=this._txtProvider.getHours();if(c>12)a=a*1+12;return this._txtProvider.setHours(a,b)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};q=function(b,d){c(q,a);a.apply(this,[b,d,47]);this.name="H"};q.prototype={getText:function(){var a=this._txtProvider.getHours();return""+a+""},setText:function(b,a){return this._txtProvider.setHours(b,a)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};r=function(b,d){c(r,a);a.apply(this,[b,d,48]);this.name="HH"};r.prototype={getText:function(){var a=this._txtProvider.getHours();if(a<10)a="0"+a;return""+a+""},setText:function(b,a){return this._txtProvider.setHours(b,a)},inc:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1+1,true)},dec:function(){this._txtProvider.setHours(this._txtProvider.getHours()*1-1,true)}};f=function(b,d){c(f,a);a.apply(this,[b,d,250]);this.name="t"};f.prototype={getText:function(){var c=this._txtProvider.getHours(),a="",b=this._txtProvider._getCulture();if(c<12)a=b.calendars.standard.AM[0];else a=b.calendars.standard.PM[0];if(a.length<=0)a=" ";return a.charAt(0)},setText:function(b){var a;if(b.toLowerCase().indexOf("a")>=0){a=this._txtProvider.getHours()*1%12;this._txtProvider.setHours(a,true)}else if(b.toLowerCase().indexOf("p")>=0){a=this._txtProvider.getHours()*1%12+12;this._txtProvider.setHours(a,true)}},inc:function(){var a=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(a,true)},dec:function(){var a=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(a,true)}};g=function(b,d){c(g,a);a.apply(this,[b,d,251]);this.name="tt"};g.prototype={getText:function(){var c=this._txtProvider.getHours(),a="",b=this._txtProvider._getCulture();if(c<12)a=b.calendars.standard.AM[0];else a=b.calendars.standard.PM[0];if(a.length<=0)a=" ";return a},setText:function(b){var a;if(b.toLowerCase().indexOf("a")>=0){a=this._txtProvider.getHours()*1%12;this._txtProvider.setHours(a,true)}else if(b.toLowerCase().indexOf("p")>=0){a=this._txtProvider.getHours()*1%12+12;this._txtProvider.setHours(a,true)}return true},inc:function(){var a=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(a,true)},dec:function(){var a=(this._txtProvider.getHours()*1+12)%24;this._txtProvider.setHours(a,true)}};s=function(b,d){c(s,a);a.apply(this,[b,d,50]);this.name="mm"};s.prototype={getText:function(){var a=this._txtProvider.getMinutes();if(a<10)a="0"+a;return""+a+""},setText:function(b,c,a){if(a&&a.isfullreset)b="0";return this._txtProvider.setMinutes(b,c)},inc:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1+1,true)},dec:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1-1,true)}};t=function(b,d){c(t,a);a.apply(this,[b,d,51]);this.name="m"};t.prototype={getText:function(){var a=this._txtProvider.getMinutes();return""+a+""},setText:function(b,c,a){if(a&&a.isfullreset)b="0";return this._txtProvider.setMinutes(b,c)},inc:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1+12,true)},dec:function(){this._txtProvider.setMinutes(this._txtProvider.getMinutes()*1-12,true)}};u=function(b,d){c(u,a);a.apply(this,[b,d,60]);this.name="ss"};u.prototype={getText:function(){var a=this._txtProvider.getSeconds();if(a<10)a="0"+a;return""+a+""},setText:function(b,c,a){if(a&&a.isfullreset)b="0";return this._txtProvider.setSeconds(b,c)},inc:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1+12,true)},dec:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1-12,true)}};v=function(b,d){c(v,a);a.apply(this,[b,d,61]);this.name="s"};v.prototype={getText:function(){var a=this._txtProvider.getSeconds();return""+a+""},setText:function(b,c,a){if(a&&a.isfullreset)b="0";return this._txtProvider.setSeconds(b,c)},inc:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1+12,true)},dec:function(){this._txtProvider.setSeconds(this._txtProvider.getSeconds()*1-12,true)}}})(jQuery);