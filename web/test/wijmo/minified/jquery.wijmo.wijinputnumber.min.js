/*
 *
 * Wijmo Library 2.2.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";var c,b;a.widget("wijmo.wijinputnumber",a.extend(true,{},wijinputcore,{options:{type:"numeric",value:null,minValue:-1e9,maxValue:1e9,showGroup:false,decimalPlaces:2,increment:1,valueChanged:null,valueBoundsExceeded:null},_createTextProvider:function(){this._textProvider=new c(this,this.options.type)},_beginUpdate:function(){var a=this.options;this.element.addClass("wijmo-wijinput-numeric");this.element.data({defaultValue:a.value,preValue:a.value}).attr({"aria-valuemin":a.minValue,"aria-valuemax":a.maxValue,"aria-valuenow":a.value||0})},_onTriggerClicked:function(){this._popupComboList()},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);wijinputcore._setOption.apply(this,arguments);switch(c){case"minValue":this.element.attr("aria-valuemin",b);this._updateText();break;case"maxValue":this.element.attr("aria-valuemax",b);this._updateText();break;case"value":this.setValue(b);this._updateText();break;case"showGroup":case"decimalPlaces":case"culture":this._textProvider.updateStringFormat();this._updateText()}},_setData:function(a){this.setValue(a)},_resetData:function(){var a=this.element.data("defaultValue");if(a===undefined||a===null){a=this.element.data("elementValue");if(a===undefined||a===null&&a==="")a=0}this.setValue(a)},_validateData:function(){!this._textProvider.checkAndRepairBounds(true,false)&&this._updateText()},_raiseDataChanged:function(){var a=this.options.value,b=this.element.data("preValue");this.element.data("preValue",a);if(b!==a){this.element.attr("aria-valuenow",a);this._trigger("valueChanged",null,{value:a})}},getValue:function(){var a=this._textProvider.getValue();if(a===undefined||a===null)a=this.getText();return a},setValue:function(a,b){try{b=!!b;if(typeof a==="boolean")a=a?"1":"0";else if(typeof a==="string")a=this._textProvider.tryParseValue(a);if(this._textProvider.setValue(a))this._updateText();else if(b){var c="",d;c=this.getText();this.setText(a);a=a.trim();d=this.getText().trim();d!==a&&this.setText(c)}else this.setText(a);return true}catch(e){return false}},isValueNull:function(){try{return this._textProvider.isValueNull()}catch(a){return true}},getPostValue:function(){if(!this._isInitialized())return this.element.val();if(this.options.showNullText&&this.isValueNull())return"0";var a=this.options.value?this.options.value:0;if(this.options.type==="percent")a=(a/100).toFixed(10);return a.toString()},_updateText:function(){if(!this._isInitialized())return;this.options.value=this._textProvider.getValue();wijinputcore._updateText.apply(this,arguments);!this._textProvider.checkAndRepairBounds(false,false)&&this._trigger("valueBoundsExceeded")},_doSpin:function(e,c){e=!!e;c=!!c;if(!this._allowEdit())return;if(c&&this.element.data("breakSpinner"))return;var d=this.element.wijtextselection(),b=new wijInputResult;if(this.element.data("focusNotCalledFirstTime")!==-9&&+new Date-this.element.data("focusNotCalledFirstTime")<600){this.element.data("focusNotCalledFirstTime",-9);this.element.data("prevCursorPos",0)}if(this.element.data("prevCursorPos")===-1)this.element.data("prevCursorPos",d.start);else d.start=this.element.data("prevCursorPos");b.testPosition=d.start;this._textProvider[e?"incEnumPart":"decEnumPart"](d.start,b,this.options.increment);this._updateText();this.element.data("prevCursorPos",b.testPosition);this.selectText(b.testPosition,b.testPosition);c&&!this.element.data("breakSpinner")&&window.setTimeout(a.proxy(function(){this._doSpin(e,true)},this),this._calcSpinInterval())}}));c=function(a,c){this.inputWidget=a;this._type=c;this._stringFormat=new b(this._type,this.inputWidget.options.decimalPlaces,this.inputWidget.options.showGroup,this._getCulture());this._stringFormat._setValueFromJSFloat(this.getValue())};c.prototype={_type:"numeric",_stringFormat:null,_getCulture:function(){return this.inputWidget._getCulture()},getDecimalSeparator:function(){return this._getCulture().numberFormat["."]},tryParseValue:function(a){return this._stringFormat.tryParseValue(a)},toString:function(){return this.inputWidget.options.showNullText&&!this.inputWidget.isFocused()&&this.isValueNull()?this.inputWidget.options.nullText:this._stringFormat.getFormattedValue()},isValueNull:function(){var a=this.inputWidget.options,b=a.minValue;return null===a.value||undefined===a.value||b===a.value},"set":function(a,b){this.clear();this.insertAt(a,0,b);return true},clear:function(){this._stringFormat.clear()},checkAndRepairBounds:function(a,d){var c=true,b,e;if(typeof a==="undefined")a=false;b=this.inputWidget.options.minValue;e=this.inputWidget.options.maxValue;if(typeof d!=="undefined"&&d)return this._stringFormat.checkMinValue(b,false,true);if(!this._stringFormat.checkMinValue(b,a,false))c=false;if(!this._stringFormat.checkMaxValue(e,a))c=false;this.inputWidget.options.decimalPlaces>=0&&this._stringFormat.checkDigitsLimits(this.inputWidget.options.decimalPlaces);return c},countSubstring:function(c,b){var d=0,a=c.indexOf(b);while(a!==-1){d++;a=c.indexOf(b,a+1)}return d},getAdjustedPositionFromLeft:function(b){for(var e=this._stringFormat._currentText,c,d=0;d<e.length;d++){c=e.charAt(d);if(!a.wij.charValidator.isDigit(c)&&c!==","&&c!=="."||c==="0"){if(this._stringFormat.isZero()){if(b<d)b++}else if(b<=d)b++}else break}return b},getDecimalSeparatorPos:function(){var a=this._stringFormat._currentText;return a.indexOf(this.getDecimalSeparator())},insertAt:function(b,d,c){var i=this._getCulture().numberFormat,j,g,f,e,h,l,k,m;if(b===i["."])b=i["."];if(!c)c=new wijInputResult;if(b.length===1){if(b==="+"){this._stringFormat.setPositiveSign();this.checkAndRepairBounds(true,false);return true}if(b==="-"||b===")"||b==="("){this._stringFormat.invertSign();this.checkAndRepairBounds(true,false);c.testPosition=d;if(this._stringFormat.isNegative())c.testPosition=d;else c.testPosition=d-2;return true}if(!a.wij.charValidator.isDigit(b)){if(b==="."){j=this.getDecimalSeparatorPos();if(j>=0){c.testPosition=j;return true}}if(b!==","&&b!=="."&&b!==")"&&b!=="+"&&b!=="-"&&b!=="("&&b!==this.getDecimalSeparator())if(this._type==="percent"&&b===i.percent.symbol){c.testPosition=d;return true}else if(this._type==="currency"&&b===i.currency.symbol){c.testPosition=d;return true}else return false}}d=this.getAdjustedPositionFromLeft(d);g=d;f=this._stringFormat._currentText;if(g>f.length)g=f.length-1;e=f.substring(0,g);h=f.substring(g,f.length);if(this._stringFormat.isZero())h=h.replace(new RegExp("[0]"),"");c.testPosition=e.length+b.length-1;this._stringFormat.deFormatValue(e+b+h);try{if(b.length===1)if(this.inputWidget.options.showGroup){l=this._stringFormat._currentText.substring(0,e.length);if(this.countSubstring(l,this._stringFormat._groupSeparator)!==this.countSubstring(e,this._stringFormat._groupSeparator))c.testPosition=c.testPosition+1}else{k=e.charAt(e.length-1);m=this._stringFormat._currentText.charAt(c.testPosition-1);if(m!==k)c.testPosition=c.testPosition-1}}catch(n){}return true},removeAt:function(c,e,a,g){var h=this._getCulture().numberFormat,b,d,f;if(!a)a=new wijInputResult;g=!!g;a.testPosition=c;try{b=this._stringFormat._currentText;if(c===e&&b.substring(c,e+1)===this.getDecimalSeparator())return false;d=b.slice(0,c)+b.slice(e+1);if(d==="")d="0";this._stringFormat.deFormatValue(d);if(c===e&&this.inputWidget.options.showGroup)try{f=this._stringFormat._currentText.substring(0,c);if(this.countSubstring(f,this._stringFormat._groupSeparator)!==this.countSubstring(d,this._stringFormat._groupSeparator)){a.testPosition=a.testPosition-1;if(b.indexOf(h.currency.symbol)===a.testPosition||b.indexOf(h.percent.symbol)===a.testPosition)a.testPosition=a.testPosition+1}}catch(i){}return true}catch(j){}return true},incEnumPart:function(c,a,b){if(!a)a=new wijInputResult;this._stringFormat.increment(b);return this.checkAndRepairBounds(true,false)},decEnumPart:function(c,a,b){if(!a)a=new wijInputResult;this._stringFormat.decrement(b);return this.checkAndRepairBounds(true,false)},getValue:function(){return this._stringFormat.getJSFloatValue()},setValue:function(a){try{this._stringFormat._setValueFromJSFloat(a);this.checkAndRepairBounds(true,false);return true}catch(b){return false}},updateStringFormat:function(){var a="0";if(typeof this._stringFormat!=="undefined")a=this._stringFormat._currentValueInString;this._stringFormat=new b(this._type,this.inputWidget.options.decimalPlaces,this.inputWidget.options.showGroup,this._getCulture());this._stringFormat._currentValueInString=a}};b=function(d,a,c,b){this.type=d;this.digitsPlaces=a;this.showGroup=c;this.culture=b};b.prototype={_currentValueInString:"0",_currentText:"0",_groupSeparator:" ",type:"numeric",digitsPlaces:0,showGroup:false,culture:null,isNegtive:function(a){return a.indexOf("-")!==-1||a.indexOf("(")!==-1},stripValue:function(a){var b=this.culture.numberFormat,h=this.isNegtive(a),d,e,c,g,f;a=a.replace("(","");a=a.replace(")","");a=a.replace("-","");a=a.replace(b.percent.symbol,"");a=a.replace(b.currency.symbol,"");d=b[","];e=b["."];switch(this.type){case"percent":d=b.percent[","];e=b.percent["."];break;case"currency":d=b.currency[","];e=b.currency["."]}this._groupSeparator=d;c=new RegExp("["+d+"]","g");a=a.replace(c,"");c=new RegExp("["+e+"]","g");a=a.replace(c,".");c=new RegExp("[ ]","g");a=a.replace(c,"");try{g=new RegExp("([\\d\\.])+");f=g.exec(a);if(f)a=f[0];if(h)a="-"+a;return a}catch(i){}return null},tryParseValue:function(a){a=this.stripValue(a);if(a===null)return 0;try{a=parseFloat(a);if(isNaN(a))a=0}catch(b){a=0}return a},deFormatValue:function(a){a=this.stripValue(a);if(a===null)return;this._currentValueInString=a;this._currentText=this.formatValue(a)},formatValue:function(c){c=""+c+"";var a=this.culture.numberFormat,j=this.digitsPlaces,h=" ",e=".",f=2,i=this.isNegtive(c),d=new Array(3),g,b;d.push(3);g="n";switch(this.type){case"numeric":g=i?a.pattern[0]:"n";h=a[","];e=a["."];f=a.decimals;d=a.groupSizes;break;case"percent":g=a.percent.pattern[i?0:1];h=a.percent[","];e=a.percent["."];f=a.percent.decimals;d=a.percent.groupSizes;break;case"currency":g=a.currency.pattern[i?0:1];h=a.currency[","];e=a.currency["."];f=a.currency.decimals;d=a.currency.groupSizes}if(j!==-2)f=j;if(!this.showGroup)d=[0];c=c.replace(new RegExp("^[0]+"),"");b=this.formatDigit(c,h,e,f,d);b=b.replace(new RegExp("^[0]+"),"");if(b.indexOf(e)===0)b="0"+b;if(b==="")b="0";this._currentValueInString=c;this._currentText=this.applyFormatPattern(g,b,a.percent.symbol,a.currency.symbol);return this._currentText},getFormattedValue:function(){return this.formatValue(this._currentValueInString)},getJSFloatValue:function(){try{return this._currentValueInString===""?0:parseFloat(this._currentValueInString)}catch(a){return Number.NaN}},clear:function(){this._currentValueInString="0";this._currentText="0"},_setValueFromJSFloat:function(a){try{this._currentValueInString=""+a+"";this.formatValue(a);return true}catch(b){return false}},isZero:function(c){try{if(c===undefined)c=this._currentValueInString;var a=c.replace("-",""),b;a=a.replace("(","");a=a.replace(")","");if(!a.length)a="0";b=parseFloat(a);if(!isNaN(b)&&!b)return true}catch(d){}return false},setPositiveSign:function(){this._currentValueInString=this._currentValueInString.replace("-","");this._currentValueInString=this._currentValueInString.replace("(","");this._currentValueInString=this._currentValueInString.replace(")","")},isNegative:function(){return this._currentValueInString.indexOf("-")!==-1||this._currentValueInString.indexOf("(")!==-1},invertSign:function(){var a=this.isNegative();if(a)this.setPositiveSign();else this._currentValueInString=!this._currentValueInString.length?"0":"-"+this._currentValueInString;if(this.isZero())this._currentValueInString=a?"0":"-0";this.formatValue(this._currentValueInString)},increment:function(b){if(b===undefined)b=1;try{var a=this._currentValueInString.split(".");this._currentValueInString=a[0]*1+b+""+(a.length>1?"."+a[1]:"")}catch(c){}},decrement:function(b){if(b===undefined)b=1;try{var a=this._currentValueInString.split(".");this._currentValueInString=a[0]*1-b+""+(a.length>1?"."+a[1]:"")}catch(c){}},checkDigitsLimits:function(f){try{var a=this._currentValueInString.split("."),d,b,c,e;if(!a.length||a.length===1&&a[0]==="")return;d="";if(a.length>1)d=a[1];b="";for(c=0;c<f;c++){e="0";if(d.length>c)e=d.charAt(c);b=b+e}if(b.length>0)this._currentValueInString=a[0]+"."+b;else this._currentValueInString=a[0]}catch(g){}},checkMinValue:function(g,i,h){if(typeof h==="undefined")h=false;var e=true,a,b,c,d,f;try{a=this._currentValueInString.split(".");b=parseFloat(a[0]===""||a[0]==="-"?"0":a[0]);c=0;if(a.length>1&&parseFloat(a[1])>0)c=parseFloat("1."+a[1]);if(b<0||a[0]==="-")c=c*-1;g=""+g+"";a=g.split(".");d=parseFloat(a[0]);f=0;if(a.length>1&&parseFloat(a[1])>0)f=parseFloat("1."+a[1]);if(b>d)return true;if(b<d||h&&b===d&&c<=f)e=false;else if(b===d&&b<0&&c>f)e=false;else if(b===d&&b>=0&&c<f)e=false;if(!e&&i)this._currentValueInString=""+g+""}catch(j){}return e},checkMaxValue:function(g,h){var d=true,a,b,c,e,f;try{a=this._currentValueInString.split(".");b=parseFloat(a[0]===""||a[0]==="-"?"0":a[0]);c=0;if(a.length>1&&parseFloat(a[1])>0)c=parseFloat("1."+a[1]);if(b<0||a[0]==="-")c=c*-1;g=""+g+"";a=g.split(".");e=parseFloat(a[0]);f=0;if(a.length>1&&parseFloat(a[1])>0)f=parseFloat("1."+a[1]);if(b<e)return true;if(b>e)d=false;if(b===e&&b>=0&&c>f)d=false;if(b===e&&b<0&&c<f)d=false;if(!d&&h)this._currentValueInString=""+g+""}catch(i){}return d},applyFormatPattern:function(f,e,d,c){var a=f,b=new RegExp("[n]","g");a=a.replace(b,e);b=new RegExp("[%]","g");a=a.replace(b,d);b=new RegExp("[$]","g");a=a.replace(b,c);return a},formatDigit:function(l,k,h,j,i){var a=""+l+"",c,b,e,g,f,d;a=a.replace("-","");a=a.replace("(","");a=a.replace(")","");c=a.indexOf(h);if(c===-1)c=a.indexOf(".");if(c===-1)c=a.indexOf(",");if(c===-1)c=a.length;b="";e=0;g=0;for(d=a.length-1;d>=0;d--){f=a.charAt(d);if(d<c){b=f+b;g++;if(g===i[e]*1&&i[e]*1&&d){b=k+b;g=0;if(i.length-1>e)e++}}}if(j>0){b=b+h;for(d=0;d<j;d++){f="0";if(d+c+1<a.length)f=a.charAt(d+c+1);b=b+f}}if(j===-1)if(c<a.length-1){b=b+h;b=b+a.substr(c+1)}return b}}})(jQuery);