/*
 *
 * Wijmo Library 2.2.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijcompositechart",a.wijmo.wijchartcore,{options:{stacked:false,clusterOverlap:0,clusterWidth:85,clusterRadius:0,clusterSpacing:0,seriesList:[],animation:{enabled:true,duration:400,easing:">"},seriesTransition:{enabled:true,duration:400,easing:">"},mouseDown:null,mouseUp:null,mouseOver:null,mouseOut:null,mouseMove:null,click:null},_create:function(){var c=this,b=c.options,d=c._getDefFill();a.each(b.seriesList,function(d,c){if(c.type==="bar"){a.extend(true,b.axis,{x:{compass:"west"},y:{compass:"south"}});return true}else if(c.type==="pie"&&c.pieSeriesList)c.data=c.pieSeriesList});a.extend(true,{compass:"east"},b.hint);if(b.is100Percent)b.is100Percent=false;a.each(b.seriesStyles,function(b,a){if(!a.fill)a.fill=d[b]});a.wijmo.wijchartcore.prototype._create.apply(c,arguments);c.chartElement.addClass("wijmo-wijcompositechart")},_setOption:function(b){b!=="is100Percent"&&a.wijmo.wijchartcore.prototype._setOption.apply(this,arguments)},destroy:function(){var d=this,b=d.chartElement,c=b.data("fields"),e=c&&c.aniBarsAttr;b.removeClass("wijmo-wijcompositechart");a.wijmo.wijchartcore.prototype.destroy.apply(this,arguments);d._destroyRaphaelArray(e);b.data("fields",null)},_isBarChart:function(){return true},_clearChartElement:function(){var c=this,e=c.options,d=c.chartElement,b=d.data("fields");if(b&&b.allElements){a.each(b.allElements,function(d,b){if(d==="scatters")b.length&&a.each(b,function(d,c){if(c.length){a.each(c,function(b,a){a&&a.remove&&a.remove();c[b]=null});b[d]=null}});c._destroyRaphaelArray(b)});b.allElements=null}a.wijmo.wijchartcore.prototype._clearChartElement.apply(c,arguments);if(b&&b.ctracers)b.ctracers=null;c.element.removeData("plotInfos");if(!e.seriesTransition.enabled)if(b&&b.aniBarsAttr)b.aniBarsAttr=null},_bindData:function(){var b=this,e=b.options,f=e.dataSource,g=e.seriesList,c=e.data,d;a.each(g,function(q,l){var e=l.data,m,n,k,j=l.dataSource||f,p=l.type,h,i,g,o=[];if(j&&e)if(p==="pie"){h=e.label;i=e.value;g=e.offset;if(h&&h.bind)h=b._getBindData(j,h.bind);if(i&&i.bind)i=b._getBindData(j,i.bind);if(g&&g.bind)g=b._getBindData(j,g.bind);if(h&&a.isArray(h)&&h.length&&i&&a.isArray(i)&&i.length){a.each(i,function(b,e){var d,c=0;if(b>=0&&b<h.length)d=h[b];if(g&&a.isArray(i)&&g.length&&b>=0&&b<g.length)c=typeof g[b]==="undefined"?0:g[b];o.push({data:e,label:d,offset:c,legendEntry:true})});l.data=o}}else{m=e.x;n=e.y;k=e.y1;if(m&&m.bind)e.x=b._getBindData(j,m.bind);else if(c&&c.x&&c.x.bind){if(d===undefined)d=b._getBindData(j,c.x.bind);e.x=d}if(n&&n.bind)e.y=b._getBindData(j,n.bind);if(k&&k.bind)e.y1=b._getBindData(j,k.bind)}})},getElement:function(f,b,c){var d=this.chartElement,e=d.data("fields"),a=e.chartElements;switch(f){case"bar":case"column":return a.bars[b];case"line":case"area":return a.paths[b];case"linemarkers":return a.markersSet[b];case"pie":return this._getPie(a,b,c)}return null},_getPie:function(b,e,d){if(d!==undefined)return b["sectors"+d]?b["sectors"+d][e]:null;else{var c=[];a.each(b,function(b,d){/sectors/.test(b)&&b!=="sectors"&&a.each(d,function(b,a){c.push(a)})});if(c.length===0)c=b.sectors;return c[e]}},_isSeriesDataEmpty:function(){var c=this,b=c.options.seriesList;if(!b||b.length===0)return true;a.each(b,function(b,a){return a.type==="pie"&&(!a.data||!a.label||a.label.length===0)?true:!a.data||(!a.data.x||!a.data.y)&&!a.data.xy?true:void 0});return false},_showSerieEles:function(d){var f=d.type,b=d.eles,e=this.options.showChartLabels,c;switch(f){case"pie":if(b.sector){b.sector.show();b.sector.shadow&&b.sector.shadow.show();b.sector.tracker&&b.sector.tracker.show()}b.label&&b.label.show();break;case"line":case"spline":case"bezier":case"area":b.markers&&a.each(b.markers,function(d,b){c=a(b.node).data("wijchartDataObj");if(c&&c.lineSeries&&c.lineSeries.markers)if(!c.lineSeries.markers.visible)return true;b.show()});b.dcl&&a.each(b.dcl,function(b,a){e&&a.show()});if(b.path){c=a(b.path.node).data("wijchartDataObj");if(c.visible){b.path.show();b.path.shadow&&b.path.shadow.show();b.path.area&&b.path.area.show();b.path.tracker&&b.path.tracker.show()}}break;case"bar":case"column":a.each(b,function(b,a){if(a.bar){a.bar.show();a.bar.shadow&&a.bar.shadow.show();a.bar.tracker&&a.bar.tracker.show()}a.dcl&&a.dcl.show();a.animatedBar&&!a.animatedBar.removed&&a.animatedBar.show()});break;case"scatter":a.each(b,function(b,a){a.show()})}},_hideSerieEles:function(c){var d=c.type,b=c.eles;switch(d){case"pie":if(b.sector){b.sector.hide();b.sector.shadow&&b.sector.shadow.hide();b.sector.tracker&&b.sector.tracker.hide()}b.label&&b.label.hide();break;case"line":case"spline":case"bezier":case"area":b.markers&&a.each(b.markers,function(b,a){a.hide()});b.dcl&&a.each(b.dcl,function(b,a){a.hide()});if(b.path){b.path.hide();b.path.shadow&&b.path.shadow.hide();b.path.area&&b.path.area.hide();b.path.tracker&&b.path.tracker.hide()}break;case"bar":case"column":a.each(b,function(b,a){if(a.bar){a.bar.hide();a.bar.shadow&&a.bar.shadow.hide();a.bar.tracker&&a.bar.tracker.hide()}a.dcl&&a.dcl.hide();a.animatedBar&&!a.animatedBar.removed&&a.animatedBar.hide()});break;case"scatter":a.each(b,function(b,a){a.hide()})}},_paintTooltip:function(){var b=this,d=b.chartElement,e=d.data("fields")||{},c=e.ctracers||[];a.wijmo.wijchartcore.prototype._paintTooltip.apply(this,arguments);b.tooltip&&a.each(c,function(c,a){if(a.trackers&&a.trackers.length)c===0&&b.tooltip.setOptions({relatedElement:a.trackers[0]})})},_paintPlotArea:function(){var b=this,c=b.options,g="seriesList",f="seriesStyles",e="seriesHoverStyles",o=c[f],m=c[e],i=b.canvasBounds,l={},h=0,p=a.isArray(c.axis.y),k={canvas:b.canvas,tooltip:b.tooltip,bounds:i,widgetName:b.widgetName,seriesTransition:c.seriesTransition,showChartLabels:c.showChartLabels,textStyle:c.textStyle,chartLabelStyle:c.chartLabelStyle,chartLabelFormatString:c.chartLabelFormatString,shadow:c.shadow,hint:c.hint,animation:c.animation,disabled:c.disabled,culture:b._getCulture(),mouseDown:function(c,a){b._trigger("mouseDown",c,a)},mouseUp:function(c,a){b._trigger("mouseUp",c,a)},mouseOver:function(c,a){b._trigger("mouseOver",c,a)},mouseOut:function(c,a){b._trigger("mouseOut",c,a)},mouseMove:function(c,a){b._trigger("mouseMove",c,a)},click:function(c,a){b._trigger("click",c,a)}},n=b.chartElement.data("fields"),d,j;if(n)n.ctracers=[];a.each(c[g],function(s,d){var j=d.type,b={},k=j,i={},q=a.extend({},o[h]),n=a.extend({},m[h]),r=d.yAxis;if(!j||j.length===0)return true;if(k==="spline"||k==="bezier")k="line";b=l[k];if(!b){if(j==="pie")b=[];else b={};l[k]=b;if(d.hint){b.hint=d.hint;if(!c.hint.content)c.hint.content=d.hint.content;if(!c.hint.title)c.hint.title=d.hint.title}}if(j==="pie"){a.each(d.data,function(c,b){q=a.extend({},o[h]);n=a.extend({},m[h]);if(!i[g])i[g]=[];if(!i[f])i[f]=[];if(!i[e])i[e]=[];b.pieID=s+1;i[g].push(b);i[f].push(q);i[e].push(n);h++});i.radius=d.radius;i.center=d.center;i.label=d.label;b.push(i);return true}else if(j==="column")b.horizontal=false;else if(j==="bar")b.horizontal=true;else if(j==="spline")d.fitType="spline";else if(j==="bezier")d.fitType="bezier";if(p)b.yAxis=r||0;if(j==="line"||j==="spline"||j==="bezier"){delete q.fill;delete n.fill}if(!b[g])b[g]=[];if(!b[f])b[f]=[];if(!b[e])b[e]=[];b[g].push(d);b[f].push(q);b[e].push(n);h++});a.each(l,function(e,f){var g=f.yAxis;switch(e){case"pie":a.each(f,function(j,g){var f=g.center,c=g.radius||50,h=f?{startX:f.x-c,startY:f.y-c,endX:f.x+c,endY:f.y+c}:{startX:i.startX+10,startY:i.startY+10,endX:i.startX+10+2*c,endY:i.startY+10+2*c};d=a.extend(true,{},k,{bounds:h,radius:c},g);b.chartElement.wijpie(d);b.chartElement.data("fields").aniSectorAttrs=null;b.chartElement.data("fields").aniLabelAttrs=null;b._savechartData(e)});break;case"bar":case"column":d=a.extend(true,{},k,{stacked:c.stacked,axis:c.axis,clusterOverlap:c.clusterOverlap,clusterWidth:c.clusterWidth,clusterSpacing:c.clusterSpacing,is100Percent:c.is100Percent,clusterRadius:c.clusterRadius,isYTime:b.axisInfo.y[0].isTime,isXTime:b.axisInfo.x.isTime,yAxisInfo:b.axisInfo.y,yAxisIndex:g},f);b.chartElement.wijbar(d);b._savechartData(e);break;case"line":case"spline":case"bezier":case"area":j=b._getyAxisGroup(f);a.each(j,function(g,f){if(!b.aniPathsAttr)b.aniPathsAttr=[];d=a.extend(true,{},k,{axis:c.axis,isXTime:b.axisInfo.x.isTime,isYTime:b.axisInfo.y[0].isTime,aniPathsAttr:b.aniPathsAttr,chartLabelEles:b.chartLabelEles,type:e==="area"?"area":"line",hole:c.hole},f);d.axis.y=c.axis.y[g]||c.axis.y;b.chartElement.wijline(d);b._savechartData(e,true)});break;case"scatter":j=b._getyAxisGroup(f);a.each(j,function(g,f){d=a.extend(true,{},k,{axis:c.axis,isXTime:b.axisInfo.x.isTime,isYTime:b.axisInfo.y[0].isTime,zoomOnHover:c.zoomOnHover},f);d.axis.y=c.axis.y[g]||c.axis.y;b.chartElement.wijscatter(d);b._savechartData(e)})}});b.chartElement.data("fields").seriesEles=null;b._bindtooltip()},_savechartData:function(f,g){var d=this,b=d.chartElement.data("fields"),h=b.seriesEles,e=b.allElements||{},c;a.each(h,function(b,a){d.seriesEles.push({eles:a,type:f})});if(g)b.ctracers=[];else{c=b.ctracers||[];c.push({trackers:b.trackers,type:f});b.ctracers=c}b&&b.chartElements&&a.each(b.chartElements,function(b,a){d._copyElements(e,b,a)});b.allElements=e},_copyElements:function(d,e,b){var c;if(b&&a.isArray(b)){c=d[e]||[];d[e]=c.concat(b)}else if(b){c=d[e]||[];c.concat([b])}},_getyAxisGroup:function(c){var b={};a.each(c.seriesList,function(e,d){var a=d.yAxis||0;if(!b[a])b[a]={seriesList:[],seriesStyles:[],seriesHoverStyles:[]};b[a].seriesList.push(d);b[a].seriesStyles.push(c.seriesStyles[e]);b[a].seriesHoverStyles.push(c.seriesHoverStyles[e])});return b},_bindtooltip:function(){var b=this,c=b.widgetName,d=b.chartElement.data("fields");d&&a.each(d.ctracers,function(b,a){a.trackers&&a.trackers.toFront()});b.chartElement.delegate(".linetracker, .bartracker, .pietracker, .wijscatterchart","mouseover."+c,a.proxy(b._tooltipMouseOver,b));b.chartElement.delegate(".linetracker, .bartracker, .pietracker, .wijscatterchart","mouseout."+c,a.proxy(b._tooltipMouseOut,b));b.chartElement.delegate(".linetracker, .bartracker, .pietracker, .wijscatterchart","mousemove."+c,a.proxy(b._tooltipMouseMove,b))},_tooltipMouseOver:function(f){var d=f.target,b=this,o=b.tooltip,i=b.options.hint,e=null,n=i.title,m=i.content,l=i.style,k=a.isFunction(n),j=a.isFunction(m),c,g,h;h=a(b.canvas.canvas.parentNode).offset();if(a(d).data("owner"))d=a(d).data("owner");d=a(d);c=d.data("wijchartDataObj");if(b.tooltip){e=o.getOptions();if(k||j){if(k)e.title=a.proxy(n,c);if(j)e.content=a.proxy(m,c)}if(c.type==="line"){if(c.path.removed)return;if(b.hoverLine!==c){b.isNewLine=true;if(b.hoverLine)if(!b.hoverLine.path.removed){b.hoverLine.path.wijAttr(b.hoverLine.lineStyle);if(b.hoverPoint&&!b.hoverPoint.isSymbol){b.hoverPoint.marker.wijAttr(b.hoverPoint.markerStyle);b.hoverPoint.marker.transform("s1")}}c.lineHoverStyle&&c.path.wijAttr(c.lineHoverStyle);b.hoverLine=c;b.hoverPoint=null;b.hoverVirtualPoint=null}}else if(c.type==="scatter"){b._clearHoverState();g=c.dot.getBBox();e.style.stroke=l.stroke||d.attr("stroke");b.tooltip.showAt({x:g.x+g.width/2,y:g.y},f)}else{b._clearHoverState();e.style.stroke=l.stroke||d.attr("stroke");b.tooltip.showAt({x:f.pageX-h.left,y:f.pageY-h.top},f)}}},_tooltipMouseMove:function(c){var e=this,b=c.target,d,f=a(e.canvas.canvas.parentNode).offset();if(a(b).data("owner"))b=a(b).data("owner");b=a(b);d=b.data("wijchartDataObj");if(e.tooltip)d.type!=="line"&&d.type!=="scatter"&&e.tooltip.showAt({x:c.pageX-f.left,y:c.pageY-f.top},c)},_tooltipMouseOut:function(e){var d=this,b=e.target,c;if(a(b).data("owner"))b=a(b).data("owner");b=a(b);c=b.data("wijchartDataObj");if(c.type!=="line")d.tooltip&&d.tooltip.hide()},_mouseMoveInsidePlotArea:function(v,r){var b=this,g=b.tooltip,k=b.options.hint,f,i,c=0,m,e,n,o,u=null,h=null,l=null,t=k.title,s=k.content,q=a.isFunction(t),p=a.isFunction(s),j=0,d;if(g)l=g.getOptions();if(b.hoverLine){d=b.hoverLine;if(b.isNewLine){k.enable&&g&&g.hide();b.isNewLine=false}f=d.lineMarkers;i=d.virtualMarkers;c=-1;m={x:0,y:0};if(f&&f.length){a.each(f,function(f,b){if(b.removed)return true;var a=b.wijGetBBox(),e=a.x+a.width/2,d=Math.abs(e-r.left);if(f===0||d<j){j=d;c=f;m={x:e,y:a.y+a.height/2}}});if(b.hoverPoint&&b.hoverPoint.index===c)return;if(c>-1){if(f[c].removed)return;e=a(f[c].node).data("wijchartDataObj");if(e){if(b.hoverPoint&&!b.hoverPoint.isSymbol)if(!b.hoverPoint.removed){b.hoverPoint.marker.wijAttr(b.hoverPoint.markerStyle);b.hoverPoint.marker.transform("s1")}if(!e.isSymbol)!e.marker.removed&&e.marker.wijAttr(e.markerHoverStyle)}b.hoverPoint=e;b.hoverVirtualPoint=i[c]}}else{a.each(i,function(d,a){var b=Math.abs(a.x-r.left);if(d===0||b<j){j=b;c=d;m={x:a.x,y:a.y}}});if(b.hoverVirtualPoint&&b.hoverVirtualPoint.index===c)return;if(c>-1){b.hoverPoint=null;b.hoverVirtualPoint=i[c]}}if(g){h=b.hoverVirtualPoint;n=h.valX;o=h.valY;if(q||p){if(q)l.title=function(){var b={pointIndex:c,lineIndex:d.index,x:n,y:o,label:d.label,data:h,fmt:t},e=a.proxy(b.fmt,b),f=e();return f};if(p)l.content=function(){var b={pointIndex:c,lineIndex:d.index,x:n,y:o,label:d.label,data:h,fmt:s},f=a.proxy(b.fmt,b),e=f();return e}}u=a.extend({stroke:d.path.attr("stroke")},k.style);l.style.stroke=u.stroke;g.showAt(m)}}a.wijmo.wijchartcore.prototype._mouseMoveInsidePlotArea.apply(b,arguments)},_mouseMoveOutsidePlotArea:function(){var b=this;b._clearHoverState();a.wijmo.wijchartcore.prototype._mouseMoveOutsidePlotArea.apply(b,arguments)},_clearHoverState:function(){var a=this,b=a.tooltip,c=a.options.hint;c.enable&&b&&b.hide();if(a.hoverLine)if(!a.hoverLine.path.removed){a.hoverLine.path.wijAttr(a.hoverLine.lineStyle);if(a.hoverPoint&&!a.hoverPoint.isSymbol){a.hoverPoint.marker.wijAttr(a.hoverPoint.markerStyle);a.hoverPoint.marker.transform("s1")}}a.hoverLine=null;a.hoverPoint=null;a.hoverVirtualPoint=null},_getTooltipText:function(){return""},_calculateParameters:function(d,g){var e=this,f=false,c,b;a.wijmo.wijchartcore.prototype._calculateParameters.apply(e,arguments);a.each(e.options.seriesList,function(b,a){if(a.type==="column"||a.type==="bar"){f=true;return false}});if(!f)return;if(d.id==="x"){c=g.unitMinor;b=e._getBarAdjustment(d);if(b===0)b=c;else if(c<b&&c!==0)b=Math.floor(b/c)*c;d.min-=b;d.max+=b;e._calculateMajorMinor(g,d)}},_getBarAdjustment:function(d){var b=0,g=this.options,f=d.max,c=d.min,e=0;a.each(g.seriesList,function(c,a){if(a.type==="pie")return true;if(a.data.x===undefined||a.data.y===undefined)return true;e=a.data.x.length;if(b<e)b=e});if(b>1)return(f-c)/b*g.clusterWidth*.0125;else if(b===1){if(c===0&&f===1){c=-1;d.min=c}return(f-c)*.0125}else return 0}})})(jQuery);